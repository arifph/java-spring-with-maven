# User Information from Success Event Listener
1. HttpSession
2. Success Event Listener
3. Authentication Success Handler
4. Get Data From HttpSession

## HttpSession
### Setup (Web.xml)
```xml
<listener>  
   <listener-class>org.springframework.web.context.request.RequestContextListener</listener-class>  
</listener>
```

## Example
```java
@Component
public class SuccessAuthListener implements ApplicationListener<InteractiveAuthenticationSuccessEvent> {

	@Autowired
	private HttpSession httpSession;
  
  ........
```

## Success Event Listener
```java
@Component
public class SuccessAuthListener implements ApplicationListener<InteractiveAuthenticationSuccessEvent> {

	@Autowired
	private HttpSession httpSession;
	
	public void onApplicationEvent(InteractiveAuthenticationSuccessEvent event) {
		// TODO Auto-generated method stub
		//System.out.println("You are successfully log in..");
		UserDetails userDetails = (UserDetails) event.getAuthentication().getPrincipal();
		String username = userDetails.getUsername();
    //User user = userDao.findUserByUsername(username);
		User user = new User();
		user.setUsername(username);
		
		httpSession.setAttribute("application-user", user);
	}
}
```

## Authentication Success Handler
### Add Bean on application context
```xml
<bean id="customAuthenticationSuccessHandler" class="com.example.arrizaqu.controller.VlexAuthenticationSuccessHandler" />
```

### Add authentication-success-handler-ref on form login
```java
<form-login
	login-page="/login"
	default-target-url="/dashboard"
	authentication-failure-url="/login?error"
	username-parameter="username"
	authentication-success-handler-ref="customAuthenticationSuccessHandler"
password-parameter="password" />
```

### Class Authentication Success Handler
```java
@Component
public class VlexAuthenticationSuccessHandler implements AuthenticationSuccessHandler {

	public void onAuthenticationSuccess(HttpServletRequest request, HttpServletResponse response, Authentication auth)
			throws IOException, ServletException {
		// TODO Auto-generated method stub
		UserDetails userDetails = (UserDetails) auth.getPrincipal();
		List<GrantedAuthority> authorities = new ArrayList();
		
		authorities.add(new SimpleGrantedAuthority("ROLE_XSIS"));
		authorities.add(new SimpleGrantedAuthority("ROLE_SB6"));
		authorities.add(new SimpleGrantedAuthority("ROLE_ADMIN"));
		
		Authentication myAuth = new UsernamePasswordAuthenticationToken(userDetails, userDetails.getPassword(), authorities);
		
		SecurityContextHolder.getContext().setAuthentication(myAuth);
		for(GrantedAuthority ga : SecurityContextHolder.getContext().getAuthentication().getAuthorities()) {
			System.err.println("name auth : "+ ga);
		}
		
		response.sendRedirect("/dashboard");
	}
}
```

## Get Data From HttpSession
### Example 
```java
..........
@Autowired
	private HttpSession httpSession;

	@RequestMapping
	public String index(Model model){
		User applicationUser =  (User) httpSession.getAttribute("application-user");
		List<Department> departments = departmentService.getAllDepartments();
		model.addAttribute("departments", departments);
		return "department";
	}
  
 .............
```
